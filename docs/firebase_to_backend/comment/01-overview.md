# ìŒì„±/í…ìŠ¤íŠ¸ ëŒ“ê¸€ ì‹œìŠ¤í…œ - ì‹œë‚˜ë¦¬ì˜¤ ë° í”Œë¡œìš°

ì´ ë¬¸ì„œëŠ” ìŒì„±/í…ìŠ¤íŠ¸ ëŒ“ê¸€ ì‹œìŠ¤í…œì˜ **ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤**ì™€ **ë°ì´í„° í”Œë¡œìš°**ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œë‚˜ë¦¬ì˜¤ 1: ìŒì„± ëŒ“ê¸€ ìƒì„±](#ì‹œë‚˜ë¦¬ì˜¤-1-ìŒì„±-ëŒ“ê¸€-ìƒì„±)
2. [ì‹œë‚˜ë¦¬ì˜¤ 2: í…ìŠ¤íŠ¸ ëŒ“ê¸€ ìƒì„±](#ì‹œë‚˜ë¦¬ì˜¤-2-í…ìŠ¤íŠ¸-ëŒ“ê¸€-ìƒì„±)
3. [ì‹œë‚˜ë¦¬ì˜¤ 3: ëŒ“ê¸€ ì¡°íšŒ](#ì‹œë‚˜ë¦¬ì˜¤-3-ëŒ“ê¸€-ì¡°íšŒ)
4. [ì‹œë‚˜ë¦¬ì˜¤ 4: ëŒ“ê¸€ ì‚­ì œ](#ì‹œë‚˜ë¦¬ì˜¤-4-ëŒ“ê¸€-ì‚­ì œ)
5. [ì‹œë‚˜ë¦¬ì˜¤ 5: í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸](#ì‹œë‚˜ë¦¬ì˜¤-5-í”„ë¡œí•„-ì´ë¯¸ì§€-ì—…ë°ì´íŠ¸)

---

## ì‹œë‚˜ë¦¬ì˜¤ 1: ìŒì„± ëŒ“ê¸€ ìƒì„±

### ì‚¬ìš©ì ìŠ¤í† ë¦¬

> "ì‚¬ì§„ì„ ë³´ë˜ ì‚¬ìš©ì Aê°€ ìŒì„± ë©”ì‹œì§€ë¥¼ ë…¹ìŒí•˜ì—¬ ëŒ“ê¸€ì„ ë‚¨ê¸°ê³ , ìì‹ ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ì‚¬ì§„ì˜ íŠ¹ì • ìœ„ì¹˜ì— ë°°ì¹˜í•œë‹¤."

### UI/UX íë¦„

```
1. ì‚¬ìš©ìê°€ ì‚¬ì§„ ìƒì„¸ í™”ë©´ì—ì„œ "ìŒì„± ëŒ“ê¸€" ë²„íŠ¼ íƒ­
   â†“
2. ë§ˆì´í¬ ê¶Œí•œ í™•ì¸ ë° ë…¹ìŒ í™”ë©´ í‘œì‹œ
   â†“
3. ë…¹ìŒ ì‹œì‘ (ë¹¨ê°„ ì› ë²„íŠ¼)
   - ì‹¤ì‹œê°„ íŒŒí˜• ì‹œê°í™” (audio_waveforms)
   - ë…¹ìŒ ì‹œê°„ í‘œì‹œ (00:00)
   - ìµœëŒ€ 5ë¶„ ì œí•œ
   â†“
4. ë…¹ìŒ ì™„ë£Œ (ì •ì§€ ë²„íŠ¼)
   - ë…¹ìŒëœ ìŒì„± ì¬ìƒ ê°€ëŠ¥
   - ë‹¤ì‹œ ë…¹ìŒ ë˜ëŠ” ì €ì¥ ì„ íƒ
   â†“
5. "ì €ì¥" ë²„íŠ¼ íƒ­
   - í”„ë¡œí•„ ì´ë¯¸ì§€ ìœ„ì¹˜ ì„ íƒ í™”ë©´ìœ¼ë¡œ ì „í™˜
   â†“
6. ì‚¬ì§„ ìœ„ì— í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ìœ„ì¹˜ ì§€ì •
   â†“
7. "ì™„ë£Œ" ë²„íŠ¼ íƒ­
   - ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ
   - ë°±ì—”ë“œ API í˜¸ì¶œ
   â†“
8. ëŒ“ê¸€ ëª©ë¡ì— ìƒˆ ëŒ“ê¸€ í‘œì‹œ (ì‹¤ì‹œê°„)
```

### ë°ì´í„° í”Œë¡œìš° (í˜„ì¬ - Firebase)

```
[Flutter App]
1. audio_waveforms.RecorderController.record()
   â†’ ë¡œì»¬ íŒŒì¼ ì €ì¥: /tmp/audio_xxxx.aac
   â†’ íŒŒí˜• ë°ì´í„° ìˆ˜ì§‘: List<double> [0.5, 0.8, 0.3, ...]

2. CommentRecordController.createCommentRecord()
   â†“
3. CommentRecordService.createCommentRecord()
   - ì…ë ¥ ê²€ì¦ (íŒŒì¼ ì¡´ì¬, í¬ê¸°, í™•ì¥ì)
   - íŒŒí˜• ë°ì´í„° ì •ê·œí™” (0.0~1.0)
   â†“
4. CommentRecordRepository.createCommentRecord()
   â†“
5. Firebase Storage ì—…ë¡œë“œ
   - ê²½ë¡œ: comment_records/{photoId}_{userId}_{timestamp}.aac
   - ë©”íƒ€ë°ì´í„°: {photoId, recorderUser, uploadedAt}
   â†’ ë‹¤ìš´ë¡œë“œ URL ë°˜í™˜
   â†“
6. Firestore ì €ì¥
   - ì»¬ë ‰ì…˜: comment_records
   - ë¬¸ì„œ ID: ìë™ ìƒì„±
   - ë°ì´í„°: {
       audioUrl: "https://...",
       photoId: "photo123",
       recorderUser: "user456",
       waveformData: [0.5, 0.8, ...],
       duration: 5000,
       profileImageUrl: "https://...",
       relativePosition: {x: 0.5, y: 0.3},
       type: "audio",
       isDeleted: false,
       createdAt: Timestamp
     }
   â†“
7. NotificationService.createVoiceCommentNotification()
   - ì‚¬ì§„ ì—…ë¡œë”ì—ê²Œ ì•Œë¦¼ ìƒì„±
   â†“
8. Firestore Snapshot â†’ Flutter UI ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
```

### ë°ì´í„° í”Œë¡œìš° (ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ - Spring Boot)

```
[Flutter App]
1. audio_waveforms.RecorderController.record()
   â†’ ë¡œì»¬ íŒŒì¼: /tmp/audio_xxxx.aac
   â†’ íŒŒí˜• ë°ì´í„°: List<double>

2. CommentRecordController.createCommentRecord()
   â†“
3. CommentRecordService.createCommentRecord() (ìˆ˜ì •)
   - ì…ë ¥ ê²€ì¦
   - íŒŒí˜• ë°ì´í„° ì •ê·œí™”
   â†“
4. CommentRecordRepository.createCommentRecord() (HTTP í´ë¼ì´ì–¸íŠ¸)
   â†“
5. POST /api/photos/{photoId}/comments/audio
   - Content-Type: multipart/form-data
   - Body: {
       audioFile: File,
       waveformData: JSON array,
       duration: 5000,
       relativeX: 0.5,
       relativeY: 0.3
     }
   - Header: Authorization: Bearer {idToken}
   â†“
[Spring Boot Backend]
6. CommentsController.createAudioComment()
   â†“
7. Firebase ID Token ê²€ì¦
   - ì‚¬ìš©ì ì¸ì¦ í™•ì¸
   â†“
8. CommentsService.createAudioComment()
   - íŒŒì¼ ìœ íš¨ì„± ê²€ì¦
   - S3 ì—…ë¡œë“œ
   â†“
9. S3Service.uploadAudioFile()
   - ê²½ë¡œ: comments/audio/{photoId}/{userId}/{timestamp}.aac
   - ACL: private
   â†’ S3 URL ë°˜í™˜
   â†“
10. CommentsRepository.save()
    - comments í…Œì´ë¸”ì— INSERT
    - waveform_data í…Œì´ë¸”ì— INSERT
    â†“
11. NotificationService.createCommentNotification()
    - ì•Œë¦¼ ìƒì„± (ë¹„ë™ê¸°)
    â†“
12. WebSocket ë˜ëŠ” SSEë¡œ ì‹¤ì‹œê°„ ì•Œë¦¼
    â†“
[Flutter App]
13. ëŒ“ê¸€ ëª©ë¡ ê°±ì‹  (í´ë§ ë˜ëŠ” WebSocket)
```

### ì—ëŸ¬ ì²˜ë¦¬

| ì—ëŸ¬ ìƒí™©              | ì²˜ë¦¬ ë°©ë²•                         |
| ---------------------- | --------------------------------- |
| ë§ˆì´í¬ ê¶Œí•œ ì—†ìŒ       | ê¶Œí•œ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ         |
| íŒŒì¼ í¬ê¸° ì´ˆê³¼ (>10MB) | "íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤" í† ìŠ¤íŠ¸  |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜          | ì¬ì‹œë„ ì˜µì…˜ í‘œì‹œ                  |
| ì„œë²„ ì˜¤ë¥˜ (500)        | "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤" í† ìŠ¤íŠ¸ |
| Firebase Auth ë§Œë£Œ     | ìë™ í† í° ê°±ì‹  í›„ ì¬ì‹œë„          |

---

## ì‹œë‚˜ë¦¬ì˜¤ 2: í…ìŠ¤íŠ¸ ëŒ“ê¸€ ìƒì„±

### ì‚¬ìš©ì ìŠ¤í† ë¦¬

> "ì‚¬ì§„ì„ ë³´ë˜ ì‚¬ìš©ì Bê°€ ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì—¬ ëŒ“ê¸€ì„ ë‚¨ê¸°ê³ , í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ë°°ì¹˜í•œë‹¤."

### UI/UX íë¦„

```
1. ì‚¬ìš©ìê°€ "í…ìŠ¤íŠ¸ ëŒ“ê¸€" ë²„íŠ¼ íƒ­
   â†“
2. í…ìŠ¤íŠ¸ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
   - TextField (ìµœëŒ€ 1000ì)
   - ê¸€ì ìˆ˜ í‘œì‹œ (0/1000)
   â†“
3. í…ìŠ¤íŠ¸ ì…ë ¥ í›„ "ë‹¤ìŒ" ë²„íŠ¼
   â†“
4. í”„ë¡œí•„ ì´ë¯¸ì§€ ìœ„ì¹˜ ì„ íƒ í™”ë©´
   â†“
5. ë“œë˜ê·¸í•˜ì—¬ ìœ„ì¹˜ ì§€ì • í›„ "ì™„ë£Œ"
   â†“
6. ëŒ“ê¸€ ëª©ë¡ì— í‘œì‹œ (ì‹¤ì‹œê°„)
```

### ë°ì´í„° í”Œë¡œìš° (í˜„ì¬ - Firebase)

```
[Flutter App]
1. ì‚¬ìš©ì í…ìŠ¤íŠ¸ ì…ë ¥: "ì¢‹ì€ ì‚¬ì§„ì´ë„¤ìš”!"
   â†“
2. CommentRecordController.createTextComment()
   â†“
3. CommentRecordService.createTextComment()
   - í…ìŠ¤íŠ¸ trim() ë° ê²€ì¦
   â†“
4. CommentRecordRepository.createTextComment()
   â†“
5. Firestore ì €ì¥
   - ë°ì´í„°: {
       audioUrl: "",
       text: "ì¢‹ì€ ì‚¬ì§„ì´ë„¤ìš”!",
       photoId: "photo123",
       recorderUser: "user789",
       waveformData: [],
       duration: 0,
       profileImageUrl: "https://...",
       relativePosition: {x: 0.7, y: 0.5},
       type: "text",
       isDeleted: false,
       createdAt: Timestamp
     }
   â†“
6. ì•Œë¦¼ ìƒì„±
   â†“
7. Firestore Snapshot â†’ UI ì—…ë°ì´íŠ¸
```

### ë°ì´í„° í”Œë¡œìš° (ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ - Spring Boot)

```
[Flutter App]
1. í…ìŠ¤íŠ¸ ì…ë ¥
   â†“
2. POST /api/photos/{photoId}/comments/text
   - Body: {
       text: "ì¢‹ì€ ì‚¬ì§„ì´ë„¤ìš”!",
       relativeX: 0.7,
       relativeY: 0.5
     }
   â†“
[Spring Boot]
3. CommentsController.createTextComment()
   â†“
4. í† í° ê²€ì¦ + ì…ë ¥ ê²€ì¦
   â†“
5. comments í…Œì´ë¸” INSERT
   - type: 'text'
   - audio_url: NULL
   - text: "ì¢‹ì€ ì‚¬ì§„ì´ë„¤ìš”!"
   â†“
6. ì•Œë¦¼ ìƒì„±
   â†“
7. Response ë°˜í™˜
   â†“
[Flutter App]
8. UI ê°±ì‹ 
```

---

## ì‹œë‚˜ë¦¬ì˜¤ 3: ëŒ“ê¸€ ì¡°íšŒ

### ì‚¬ìš©ì ìŠ¤í† ë¦¬

> "ì‚¬ìš©ìê°€ ì‚¬ì§„ì„ ì—´ë©´ í•´ë‹¹ ì‚¬ì§„ì˜ ëª¨ë“  ëŒ“ê¸€ë“¤ì´ ì‹œê°„ìˆœìœ¼ë¡œ í‘œì‹œë˜ê³ , ê° ëŒ“ê¸€ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì‚¬ì§„ ìœ„ì— ë°°ì¹˜ëœë‹¤."

### UI/UX íë¦„

```
1. ì‚¬ì§„ ìƒì„¸ í™”ë©´ ì§„ì…
   â†“
2. ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ
   â†“
3. ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ (ë°±ì—”ë“œ API)
   â†“
4. ì‚¬ì§„ ìœ„ì— í”„ë¡œí•„ ì´ë¯¸ì§€ë“¤ ë Œë”ë§
   - ê° ëŒ“ê¸€ì˜ relativePosition ê¸°ë°˜
   - í”„ë¡œí•„ ì´ë¯¸ì§€ í´ë¦­ ì‹œ ëŒ“ê¸€ ì¬ìƒ/í‘œì‹œ
   â†“
5. í•˜ë‹¨ì— ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
   - ì‹œê°„ìˆœ ì •ë ¬ (createdAt ASC)
   - ìŒì„±: ì¬ìƒ ë²„íŠ¼ + íŒŒí˜•
   - í…ìŠ¤íŠ¸: í…ìŠ¤íŠ¸ ë‚´ìš©
```

### ë°ì´í„° í”Œë¡œìš° (í˜„ì¬ - Firebase)

```
[Flutter App]
1. ì‚¬ì§„ ìƒì„¸ í™”ë©´ ì§„ì…
   â†“
2. CommentRecordController.loadCommentRecordsByPhotoId(photoId)
   â†“
3. ìºì‹œ í™•ì¸
   - ìºì‹œ ìˆìœ¼ë©´: UIì— ì¦‰ì‹œ í‘œì‹œ
   - ìºì‹œ ì—†ìœ¼ë©´: ê³„ì† ì§„í–‰
   â†“
4. CommentRecordService.getCommentRecordsByPhotoId()
   â†“
5. CommentRecordRepository.getCommentRecordsByPhotoId()
   â†“
6. Firestore ì¿¼ë¦¬
   - WHERE photoId == "photo123"
   - WHERE isDeleted == false
   - ORDER BY createdAt ASC
   â†“
7. ê²°ê³¼ ë°˜í™˜: List<CommentRecordModel>
   â†“
8. ìºì‹œ ì—…ë°ì´íŠ¸
   â†“
9. UI ë Œë”ë§
```

### ë°ì´í„° í”Œë¡œìš° (ë§ˆì´ê·¸ë ˆì´ì…˜ í›„)

```
[Flutter App]
1. ì‚¬ì§„ ìƒì„¸ í™”ë©´ ì§„ì…
   â†“
2. GET /api/photos/{photoId}/comments
   - Query params: page=0, size=100
   â†“
[Spring Boot]
3. CommentsController.getCommentsByPhoto()
   â†“
4. í† í° ê²€ì¦
   â†“
5. CommentsService.getCommentsByPhotoId()
   â†“
6. CommentsRepository.findByPhotoId()
   - SQL:
     SELECT * FROM comments
     WHERE photo_id = ?
       AND is_deleted = FALSE
     ORDER BY created_at ASC
     LIMIT 100 OFFSET 0
   â†“
7. DTO ë³€í™˜ (waveform_data JOIN)
   â†“
8. Response: {
     comments: [...],
     totalCount: 25
   }
   â†“
[Flutter App]
9. ìºì‹œ ì—…ë°ì´íŠ¸ + UI ë Œë”ë§
```

---

## ì‹œë‚˜ë¦¬ì˜¤ 4: ëŒ“ê¸€ ì‚­ì œ

### ì‚¬ìš©ì ìŠ¤í† ë¦¬

> "ì‚¬ìš©ìê°€ ìì‹ ì´ ì‘ì„±í•œ ëŒ“ê¸€ì„ ê¸¸ê²Œ ëˆŒëŸ¬ ì‚­ì œí•œë‹¤. ìì‹ ì˜ ëŒ“ê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆë‹¤."

### UI/UX íë¦„

```
1. ëŒ“ê¸€ì„ ê¸¸ê²Œ ëˆ„ë¦„ (Long Press)
   â†“
2. í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
   - "ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
   - [ì·¨ì†Œ] [ì‚­ì œ]
   â†“
3. "ì‚­ì œ" ë²„íŠ¼ íƒ­
   - UIì—ì„œ ì¦‰ì‹œ ì œê±° (Optimistic UI)
   - ë°±ê·¸ë¼ìš´ë“œì—ì„œ API í˜¸ì¶œ
   â†“
4. ì„±ê³µ: ê·¸ëŒ€ë¡œ ìœ ì§€
   ì‹¤íŒ¨: ë¡¤ë°± + ì—ëŸ¬ í† ìŠ¤íŠ¸
```

### ë°ì´í„° í”Œë¡œìš° (í˜„ì¬ - Firebase)

```
[Flutter App]
1. ëŒ“ê¸€ ì‚­ì œ ìš”ì²­
   â†“
2. CommentRecordController.deleteCommentRecord(commentId, photoId)
   â†“
3. UIì—ì„œ ì¦‰ì‹œ ì œê±° (Optimistic)
   - _commentRecordsì—ì„œ ì œê±°
   - _commentCacheì—ì„œ ì œê±°
   - notifyListeners()
   â†“
4. CommentRecordService.deleteCommentRecord()
   â†“
5. CommentRecordRepository.deleteCommentRecord()
   â†“
6. Firestore ì—…ë°ì´íŠ¸
   - UPDATE: isDeleted = true
   â†“
7. ì„±ê³µ: ì•„ë¬´ ì‘ì—… ì—†ìŒ
   ì‹¤íŒ¨: ë¡¤ë°±
```

### ë°ì´í„° í”Œë¡œìš° (ë§ˆì´ê·¸ë ˆì´ì…˜ í›„)

```
[Flutter App]
1. ëŒ“ê¸€ ì‚­ì œ ìš”ì²­
   â†“
2. UI ì¦‰ì‹œ ì œê±° (Optimistic)
   â†“
3. DELETE /api/comments/{commentId}
   â†“
[Spring Boot]
4. CommentsController.deleteComment()
   â†“
5. í† í° ê²€ì¦
   â†“
6. ê¶Œí•œ í™•ì¸
   - ë³¸ì¸ ëŒ“ê¸€ì¸ê°€?
   â†“
7. CommentsService.deleteComment()
   â†“
8. CommentsRepository.softDelete()
   - SQL:
     UPDATE comments
     SET is_deleted = TRUE,
         updated_at = NOW()
     WHERE id = ?
   â†“
9. Response: 200 OK
   â†“
[Flutter App]
10. ì„±ê³µ: ìœ ì§€
    ì‹¤íŒ¨: ë¡¤ë°±
```

### ê¶Œí•œ ë¡œì§

```
ëŒ“ê¸€ ì‚­ì œ ê°€ëŠ¥ ì¡°ê±´:
- í˜„ì¬ ì‚¬ìš©ì ID == ëŒ“ê¸€ ì‘ì„±ì ID

ê·¸ ì™¸: 403 Forbidden
```

---

## ì‹œë‚˜ë¦¬ì˜¤ 5: í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸

### ì‚¬ìš©ì ìŠ¤í† ë¦¬

> "ì‚¬ìš©ìê°€ í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ë³€ê²½í•˜ë©´, í•´ë‹¹ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ëª¨ë“  ëŒ“ê¸€ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ë„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ëœë‹¤."

### UI/UX íë¦„

```
1. ì„¤ì • í™”ë©´ì—ì„œ í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½
   â†“
2. AuthController.updateProfileImage()
   - Firebase Storage ì—…ë¡œë“œ
   - Firestore users ë¬¸ì„œ ì—…ë°ì´íŠ¸
   â†“
3. ì—°ì‡„ì ìœ¼ë¡œ ëŒ“ê¸€ í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
   - CommentRecordController.updateUserProfileImageUrl()
   â†“
4. ëª¨ë“  ëŒ“ê¸€ì˜ profileImageUrl ê°±ì‹ 
```

### ë°ì´í„° í”Œë¡œìš° (í˜„ì¬ - Firebase)

```
[Flutter App - AuthController]
1. í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ
   - ìƒˆ URL: "https://storage.../new_profile.jpg"
   â†“
2. Firestore users ì—…ë°ì´íŠ¸
   â†“
3. CommentRecordController.updateUserProfileImageUrl()
   â†“
4. CommentRecordService.updateUserProfileImageUrl()
   â†“
5. CommentRecordRepository.updateUserProfileImageUrl()
   â†“
6. Firestore ë°°ì¹˜ ì—…ë°ì´íŠ¸
   - WHERE recorderUser == userId
   - WHERE isDeleted == false
   - UPDATE profileImageUrl = "https://..."
   â†“
7. ìºì‹œ ê°±ì‹ 
   - _commentCacheì˜ ëª¨ë“  ëŒ“ê¸€ ìˆœíšŒ
   - userId ì¼ì¹˜í•˜ëŠ” ëŒ“ê¸€ì˜ profileImageUrl ê°±ì‹ 
   â†“
8. notifyListeners()
```

### ë°ì´í„° í”Œë¡œìš° (ë§ˆì´ê·¸ë ˆì´ì…˜ í›„)

```
[Flutter App - AuthController]
1. í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½ ì™„ë£Œ
   â†“
2. PUT /api/users/me/profile-image
   â†“
[Spring Boot - UserService]
3. S3 ì—…ë¡œë“œ + users í…Œì´ë¸” ì—…ë°ì´íŠ¸
   â†“
4. CommentsService.updateUserProfileImageUrl() í˜¸ì¶œ
   â†“
5. SQL:
   UPDATE comments
   SET profile_image_url = ?
   WHERE recorder_user_id = ?
     AND is_deleted = FALSE
   â†“
6. Response: 200 OK
   â†“
[Flutter App]
7. ìºì‹œ ê°±ì‹ 
   â†“
8. UI ê°±ì‹ 
```

---

## ğŸ”„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë¹„êµ

### í˜„ì¬ (Firebase)

```
Firestore Snapshot Listener
    â†“
getCommentRecordsStream(photoId)
    â†“
StreamBuilder in Flutter
    â†“
UI ìë™ ì—…ë°ì´íŠ¸
```

**ì¥ì **: ê°„ë‹¨í•œ êµ¬í˜„  
**ë‹¨ì **: Firebase ì¢…ì†ì„±

### ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ (Spring Boot)

#### ì˜µì…˜ 1: í´ë§ (ì´ˆê¸° ë‹¨ê³„)

```
Timer.periodic(Duration(seconds: 5), (_) {
  GET /api/photos/{photoId}/comments
})
```

**ì¥ì **: êµ¬í˜„ ê°„ë‹¨  
**ë‹¨ì **: ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­

#### ì˜µì…˜ 2: WebSocket (ê¶Œì¥)

```
WebSocket ì—°ê²°
    â†“
ëŒ“ê¸€ ìƒì„±/ì‚­ì œ ì‹œ ì„œë²„ê°€ ë©”ì‹œì§€ ì „ì†¡
    â†“
Flutter WebSocket Listener
    â†“
UI ì—…ë°ì´íŠ¸
```

**ì¥ì **: ì‹¤ì‹œê°„, íš¨ìœ¨ì   
**ë‹¨ì **: êµ¬í˜„ ë³µì¡ë„ ì¦ê°€

#### ì˜µì…˜ 3: Server-Sent Events (SSE)

```
EventSource ì—°ê²°
    â†“
ì„œë²„ì—ì„œ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ ì „ì†¡
    â†“
Flutter SSE Listener
    â†“
UI ì—…ë°ì´íŠ¸
```

**ì¥ì **: ë‹¨ë°©í–¥ í†µì‹ ì— ìµœì   
**ë‹¨ì **: ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œ ì œí•œ

---

## ğŸ“Š ë°ì´í„° íë¦„ ìš”ì•½

| ê¸°ëŠ¥             | í˜„ì¬ (Firebase)     | ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ (Spring Boot) |
| ---------------- | ------------------- | ----------------------------- |
| ìŒì„± ëŒ“ê¸€ ìƒì„±   | Firestore + Storage | PostgreSQL + S3               |
| í…ìŠ¤íŠ¸ ëŒ“ê¸€ ìƒì„± | Firestore           | PostgreSQL                    |
| ëŒ“ê¸€ ì¡°íšŒ        | Firestore Query     | SQL Query                     |
| ëŒ“ê¸€ ì‚­ì œ        | Firestore Update    | SQL UPDATE                    |
| ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸  | Snapshot Listener   | WebSocket/SSE/Polling         |
| íŒŒì¼ ì—…ë¡œë“œ      | í´ë¼ì´ì–¸íŠ¸ ì§ì ‘     | ë°±ì—”ë“œ ê²½ìœ                    |

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

ì´ ë¬¸ì„œë¥¼ ì´í•´í–ˆë‹¤ë©´:

1. [02-business-rules.md](./02-business-rules.md)ì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ í™•ì¸
2. [03-api-endpoints.md](./03-api-endpoints.md)ì—ì„œ API ëª…ì„¸ í™•ì¸
3. [04-data-models.md](./04-data-models.md)ì—ì„œ DB ìŠ¤í‚¤ë§ˆ í™•ì¸
4. [05-features.md](./05-features.md)ì—ì„œ êµ¬í˜„ ê°€ì´ë“œ í™•ì¸
