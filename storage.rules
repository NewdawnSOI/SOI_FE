rules_version = '2';

// Firebase Storage 보안 규칙
service firebase.storage {
  match /b/{bucket}/o {
    // 기본 규칙: 인증된 사용자만 읽기/쓰기 가능
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // 사용자 프로필 이미지 (profiles 폴더) - 공개 읽기, 소유자만 쓰기
    match /profiles/{userId}/{allPaths=**} {
      allow read: if true; // 모든 사용자가 프로필 이미지 읽기 가능
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 사용자 프로필 이미지 (각자의 UID 폴더에만 접근 가능)
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 사진 및 오디오 파일 (공개 읽기, 소유자만 쓰기)
    match /photos/{photoId} {
      allow read: if true; // 모든 사용자가 읽기 가능
      allow write: if request.auth != null; // 인증된 사용자만 업로드 가능
    }
    
    match /audio/{audioId} {
      allow read: if true; // 모든 사용자가 읽기 가능  
      allow write: if request.auth != null; // 인증된 사용자만 업로드 가능
    }
    
    // 음성 댓글 파일
    match /comment_records/{allPaths=**} {
      allow read: if true; // 모든 사용자가 읽기 가능
      allow write: if request.auth != null; // 인증된 사용자만 업로드 가능
    }
    
    // 임시 파일 (업로드 중인 파일들)
    match /temp/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}